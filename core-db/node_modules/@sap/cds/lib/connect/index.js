const Session = require('./session')
const cds = require('../index')

module.exports = function (options) {
  if (arguments.length > 1) return require('./_compat').connect(...arguments)
  if (cds.session) return cds
  const primary = cds.session = new Session(options)
  // Decorate cds to serve as a shortcut to the primary session
  Object.defineProperties(cds, {
    run: {configurable: true, value: (...a) => primary.run(...a)},
    foreach: {configurable: true, value: (...a) => primary.foreach(...a)},
    deploy: {configurable: true, value: (...a) => primary.deploy(...a)},
    model: {configurable: true, get: () => primary.model}
  })
  // SELECT, INSERT, UPDATE, DELETE, cds as globals
  return Object.assign(global, cds.ql).cds = cds
}
